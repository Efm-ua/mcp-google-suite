# –ü–æ—Å—ñ–±–Ω–∏–∫ –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è mcp-gsuite-server –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è Google Docs (v4 - BATTLE-TESTED)

–¶–µ–π –¥–æ–∫—É–º–µ–Ω—Ç —î —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ—é –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–æ—é –ø—Ä–æ—Ü–µ–¥—É—Ä–æ—é (SOP) –¥–ª—è –∞–≥–µ–Ω—Ç–∞ Cursor AI.

## –†–æ–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å

1.  **–û—Ç—Ä–∏–º–∞–π –ø–∞—Ä–∞–º–µ—Ç—Ä–∏:** –ê—Ä—Ö—ñ—Ç–µ–∫—Ç–æ—Ä –Ω–∞–¥–∞—Å—Ç—å `DOCUMENT_ID` —Ç–∞ `TASK_TYPE`.
2.  **–°–∫–æ–ø—ñ—é–π —à–∞–±–ª–æ–Ω:** –ü–æ–≤–Ω—ñ—Å—Ç—é —Å–∫–æ–ø—ñ—é–π Python-—Å–∫—Ä–∏–ø—Ç –∑ —Ä–æ–∑–¥—ñ–ª—É "–®–∞–±–ª–æ–Ω Python-—Å–∫—Ä–∏–ø—Ç–∞ v4".
3.  **–°—Ç–≤–æ—Ä–∏ —Ç–∞ –≤–∏–∫–æ–Ω–∞–π:** –°—Ç–≤–æ—Ä–∏ —Ç–∏–º—á–∞—Å–æ–≤–∏–π —Ñ–∞–π–ª `temp_gdoc_update.py`, –≤—Å—Ç–∞–≤ —É –Ω—å–æ–≥–æ —à–∞–±–ª–æ–Ω, –∑–∞–º—ñ–Ω–∏ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∏, –≤–∏–∫–æ–Ω–∞–π —Ç–∞ –≤–∏–¥–∞–ª–∏.

---

## üö® –í–∞–∂–ª–∏–≤—ñ –ø—Ä–∏–º—ñ—Ç–∫–∏ (–∑ –±–æ–π–æ–≤–æ–≥–æ –¥–æ—Å–≤—ñ–¥—É)

### ‚ö†Ô∏è **–ü–æ—à–∏—Ä–µ–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏ —Ç–∞ —ó—Ö –≤–∏—Ä—ñ—à–µ–Ω–Ω—è:**

1. **–ü–æ–º–∏–ª–∫–∞ 'DocsService' object has no attribute 'logger'**
   - –ü—Ä–∏—á–∏–Ω–∞: –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å logger –≤ DocsService
   - –°—Ç–∞—Ç—É—Å: –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –∫–æ–¥—ñ —Å–µ—Ä–≤–µ—Ä–∞ (–∑–∞–º—ñ–Ω–∞ –Ω–∞ print)

2. **–î—É–±–ª—ñ–∫–∞—Ç–∏ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º—É –∑–∞–ø—É—Å–∫—É**
   - –ü—Ä–∏—á–∏–Ω–∞: –ü–æ–≤—Ç–æ—Ä–Ω–∏–π –∑–∞–ø—É—Å–∫ –±–µ–∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —ñ—Å–Ω—É–≤–∞–Ω–Ω—è
   - –†—ñ—à–µ–Ω–Ω—è: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏—á–Ω–∏–π —Å–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–¥ –æ—Å–Ω–æ–≤–Ω–∏–º

3. **–ü–æ–º–∏–ª–∫–∞ "–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞" –ø—Ä–∏ –≤–µ–ª–∏–∫–∏—Ö batch –æ–ø–µ—Ä–∞—Ü—ñ—è—Ö**
   - –ü—Ä–∏—á–∏–Ω–∞: –ó–∞–Ω–∞–¥—Ç–æ –±–∞–≥–∞—Ç–æ –æ–ø–µ—Ä–∞—Ü—ñ–π –æ–¥–Ω–æ—á–∞—Å–Ω–æ (>5)
   - –†—ñ—à–µ–Ω–Ω—è: –ü–∞—Ä—Ç—ñ–π–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –ø–æ 3 –æ–ø–µ—Ä–∞—Ü—ñ—ó

4. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ API**
   - `docs_append_formatted_text` –ø–æ—Ç—Ä–µ–±—É—î `text_content`, –Ω–µ `content`
   - `docs_batch_update` –ø–æ—Ç—Ä–µ–±—É—î `requests` —è–∫ –º–∞—Å—Å–∏–≤

---

## üîß –î—ñ–∞–≥–Ω–æ—Å—Ç–∏—á–Ω–∏–π —à–∞–±–ª–æ–Ω (–ø–µ—Ä–µ–¥ –æ—Å–Ω–æ–≤–Ω–æ—é —Ä–æ–±–æ—Ç–æ—é)

```python
# –î—ñ–∞–≥–Ω–æ—Å—Ç–∏—á–Ω–∏–π —Å–∫—Ä–∏–ø—Ç - –∑–∞–≤–∂–¥–∏ –≤–∏–∫–æ–Ω—É–π –ø–µ—Ä–µ–¥ –æ—Å–Ω–æ–≤–Ω–∏–º
import asyncio
import httpx

DOCUMENT_ID = "[[DOCUMENT_ID]]"
GSUITE_SERVER_URL = "https://mcp-gsuite-server-778416671000.us-central1.run.app"
EXPECTED_CONTENT = "[[CONTENT_TO_CHECK]]"  # –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –∑–∞–≥–æ–ª–æ–≤–æ–∫ L2-–ø—ñ–¥—Å—É–º–∫—É

async def main():
    async with httpx.AsyncClient(timeout=90.0) as client:
        # –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞–Ω –¥–æ–∫—É–º–µ–Ω—Ç–∞
        response = await client.post(
            f"{GSUITE_SERVER_URL}/invoke-tool",
            json={"tool_name": "docs_get_content", "params": {"document_id": DOCUMENT_ID}}
        )
        content = response.json().get("result", {}).get("content", "")
        
        count = content.count(EXPECTED_CONTENT)
        print(f"üîç –ó–Ω–∞–π–¥–µ–Ω–æ {count} –∫–æ–ø—ñ–π '{EXPECTED_CONTENT}'")
        print(f"üìä –†–æ–∑–º—ñ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞: {len(content)} —Å–∏–º–≤–æ–ª—ñ–≤")
        
        # –¢–µ—Å—Ç –ø—Ä–æ—Å—Ç–æ—ó –æ–ø–µ—Ä–∞—Ü—ñ—ó
        test_response = await client.post(
            f"{GSUITE_SERVER_URL}/invoke-tool",
            json={"tool_name": "docs_batch_update", "params": {
                "document_id": DOCUMENT_ID,
                "requests": [{"replaceAllText": {"containsText": {"text": "test", "matchCase": False}, "replaceText": "test"}}]
            }}
        )
        
        if test_response.status_code == 200:
            print("‚úÖ docs_batch_update –ø—Ä–∞—Ü—é—î")
        else:
            print(f"‚ùå docs_batch_update –Ω–µ –ø—Ä–∞—Ü—é—î: {test_response.status_code}")

if __name__ == "__main__":
    asyncio.run(main())
```

---

## –®–∞–±–ª–æ–Ω Python-—Å–∫—Ä–∏–ø—Ç–∞ v4 (—Å–ø—Ä–æ—â–µ–Ω–∏–π —ñ —Å—Ç–∞–±—ñ–ª—å–Ω–∏–π)

```python
# === –®–ê–ë–õ–û–ù v4 - BATTLE-TESTED ===
import asyncio
import httpx
import json
from typing import List

# --- –ü–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∏ –¥–ª—è –∑–∞–º—ñ–Ω–∏ ---
DOCUMENT_ID = "[[DOCUMENT_ID]]"
TASK_TYPE = "[[TASK_TYPE]]"  # "APPEND_SUMMARY", "BATCH_TAG_L1_RECORDS"
CONTENT_TO_APPEND = """[[CONTENT_TO_APPEND]]"""
L1_HEADINGS_TO_TAG: List[str] = [[L1_SUMMARY_HEADINGS_TO_TAG]]
TAG_TO_APPLY = "[[TAG_TO_APPLY]]"

# --- –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è ---
GSUITE_SERVER_URL = "https://mcp-gsuite-server-778416671000.us-central1.run.app"
BATCH_SIZE = 3  # –ú–∞–∫—Å–∏–º—É–º –æ–ø–µ—Ä–∞—Ü—ñ–π –≤ –æ–¥–Ω—ñ–π –ø–∞—Ä—Ç—ñ—ó

async def main():
    print(f"üöÄ –ó–∞–ø—É—Å–∫ –∑–∞–≤–¥–∞–Ω–Ω—è '{TASK_TYPE}' –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞ ID: {DOCUMENT_ID[:10]}...")
    async with httpx.AsyncClient(timeout=90.0) as client:
        try:
            if TASK_TYPE == "APPEND_SUMMARY":
                # –ö—Ä–æ–∫ 1: –î–æ–¥–∞—Ç–∏ L2-–ø—ñ–¥—Å—É–º–æ–∫
                print("üìù –î–æ–¥–∞–≤–∞–Ω–Ω—è L2-–ø—ñ–¥—Å—É–º–∫—É...")
                append_response = await client.post(
                    f"{GSUITE_SERVER_URL}/invoke-tool",
                    json={"tool_name": "docs_append_formatted_text", "params": {
                        "document_id": DOCUMENT_ID,
                        "text_content": CONTENT_TO_APPEND
                    }}
                )
                
                if append_response.status_code == 200 and append_response.json().get("result", {}).get("success"):
                    print("‚úÖ L2-–ø—ñ–¥—Å—É–º–æ–∫ —É—Å–ø—ñ—à–Ω–æ –¥–æ–¥–∞–Ω–æ")
                else:
                    print(f"‚ùå –ü–æ–º–∏–ª–∫–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è L2-–ø—ñ–¥—Å—É–º–∫—É: {append_response.text}")
                    return
                    
            elif TASK_TYPE == "BATCH_TAG_L1_RECORDS":
                # –ö—Ä–æ–∫ 2: –¢–µ–≥—É–≤–∞–Ω–Ω—è L1-–∑–∞–ø–∏—Å—ñ–≤ –ø–∞—Ä—Ç—ñ—è–º–∏
                print("üè∑Ô∏è  –î–æ–¥–∞–≤–∞–Ω–Ω—è —Ç–µ–≥—ñ–≤ –¥–æ L1-–∑–∞–ø–∏—Å—ñ–≤...")
                
                for i in range(0, len(L1_HEADINGS_TO_TAG), BATCH_SIZE):
                    batch = L1_HEADINGS_TO_TAG[i:i + BATCH_SIZE]
                    print(f"  –û–±—Ä–æ–±–∫–∞ –ø–∞—Ä—Ç—ñ—ó {i//BATCH_SIZE + 1}: {batch}")
                    
                    # –°—Ç–≤–æ—Ä–∏—Ç–∏ –æ–ø–µ—Ä–∞—Ü—ñ—ó —Ç–µ–≥—É–≤–∞–Ω–Ω—è –¥–ª—è —Ü—ñ—î—ó –ø–∞—Ä—Ç—ñ—ó
                    requests = []
                    for heading in batch:
                        requests.append({
                            "replaceAllText": {
                                "containsText": {"text": heading, "matchCase": False},
                                "replaceText": f"{TAG_TO_APPLY} {heading}"
                            }
                        })
                    
                    # –í–∏–∫–æ–Ω–∞—Ç–∏ –ø–∞—Ä—Ç—ñ—é –æ–ø–µ—Ä–∞—Ü—ñ–π
                    batch_response = await client.post(
                        f"{GSUITE_SERVER_URL}/invoke-tool",
                        json={"tool_name": "docs_batch_update", "params": {
                            "document_id": DOCUMENT_ID,
                            "requests": requests
                        }}
                    )
                    
                    if batch_response.status_code == 200:
                        result = batch_response.json()
                        if result.get("result", {}).get("success"):
                            print(f"    ‚úÖ –ü–∞—Ä—Ç—ñ—è {i//BATCH_SIZE + 1} —É—Å–ø—ñ—à–Ω–æ –æ–±—Ä–æ–±–ª–µ–Ω–∞")
                        else:
                            print(f"    ‚ùå –ü–æ–º–∏–ª–∫–∞ –ø–∞—Ä—Ç—ñ—ó {i//BATCH_SIZE + 1}: {result}")
                            return
                    else:
                        print(f"    ‚ùå HTTP –ø–æ–º–∏–ª–∫–∞ –ø–∞—Ä—Ç—ñ—ó {i//BATCH_SIZE + 1}: {batch_response.status_code}")
                        return
                        
                    # –ü–∞—É–∑–∞ –º—ñ–∂ –ø–∞—Ä—Ç—ñ—è–º–∏
                    await asyncio.sleep(1)
            
            elif TASK_TYPE == "FULL_ROLLUP":
                # –ö–æ–º–±—ñ–Ω–æ–≤–∞–Ω–∏–π —Ä–µ–∂–∏–º: —Å–ø–æ—á–∞—Ç–∫—É –¥–æ–¥–∞—Ç–∏ –ø—ñ–¥—Å—É–º–æ–∫, –ø–æ—Ç—ñ–º —Ç–µ–≥–∏
                print("üìù –ö—Ä–æ–∫ 1: –î–æ–¥–∞–≤–∞–Ω–Ω—è L2-–ø—ñ–¥—Å—É–º–∫—É...")
                append_response = await client.post(
                    f"{GSUITE_SERVER_URL}/invoke-tool",
                    json={"tool_name": "docs_append_formatted_text", "params": {
                        "document_id": DOCUMENT_ID,
                        "text_content": CONTENT_TO_APPEND
                    }}
                )
                
                if not (append_response.status_code == 200 and append_response.json().get("result", {}).get("success")):
                    print(f"‚ùå –ü–æ–º–∏–ª–∫–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è L2-–ø—ñ–¥—Å—É–º–∫—É: {append_response.text}")
                    return
                print("‚úÖ L2-–ø—ñ–¥—Å—É–º–æ–∫ –¥–æ–¥–∞–Ω–æ")
                
                # –¢–µ–≥—É–≤–∞–Ω–Ω—è L1-–∑–∞–ø–∏—Å—ñ–≤
                print("üè∑Ô∏è  –ö—Ä–æ–∫ 2: –î–æ–¥–∞–≤–∞–Ω–Ω—è —Ç–µ–≥—ñ–≤ –¥–æ L1-–∑–∞–ø–∏—Å—ñ–≤...")
                for i in range(0, len(L1_HEADINGS_TO_TAG), BATCH_SIZE):
                    batch = L1_HEADINGS_TO_TAG[i:i + BATCH_SIZE]
                    print(f"  –û–±—Ä–æ–±–∫–∞ –ø–∞—Ä—Ç—ñ—ó {i//BATCH_SIZE + 1}: {batch}")
                    
                    requests = []
                    for heading in batch:
                        requests.append({
                            "replaceAllText": {
                                "containsText": {"text": heading, "matchCase": False},
                                "replaceText": f"{TAG_TO_APPLY} {heading}"
                            }
                        })
                    
                    batch_response = await client.post(
                        f"{GSUITE_SERVER_URL}/invoke-tool",
                        json={"tool_name": "docs_batch_update", "params": {
                            "document_id": DOCUMENT_ID,
                            "requests": requests
                        }}
                    )
                    
                    if batch_response.status_code == 200 and batch_response.json().get("result", {}).get("success"):
                        print(f"    ‚úÖ –ü–∞—Ä—Ç—ñ—è {i//BATCH_SIZE + 1} —É—Å–ø—ñ—à–Ω–æ –æ–±—Ä–æ–±–ª–µ–Ω–∞")
                    else:
                        print(f"    ‚ùå –ü–æ–º–∏–ª–∫–∞ –ø–∞—Ä—Ç—ñ—ó {i//BATCH_SIZE + 1}")
                        return
                        
                    await asyncio.sleep(1)
            
            print("‚úÖ‚úÖ‚úÖ –ó–ê–í–î–ê–ù–ù–Ø –£–°–ü–Ü–®–ù–û –ó–ê–í–ï–†–®–ï–ù–û!")
            
        except Exception as e:
            print(f"‚ùå‚ùå‚ùå –ö–†–ò–¢–ò–ß–ù–ê –ü–û–ú–ò–õ–ö–ê! {type(e).__name__}: {e}")

if __name__ == "__main__":
    asyncio.run(main())
```

---

## üîÑ –°—Ç—Ä–∞—Ç–µ–≥—ñ—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—ñ—Å–ª—è –ø–æ–º–∏–ª–æ–∫

### –Ø–∫—â–æ –≤–∏–Ω–∏–∫–ª–∏ –¥—É–±–ª—ñ–∫–∞—Ç–∏:
1. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏—á–Ω–∏–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—ñ–¥—Ä–∞—Ö—É–Ω–∫—É –∫–æ–ø—ñ–π
2. –°—Ç–≤–æ—Ä–∏ —Å–∫—Ä–∏–ø—Ç –æ—á–∏—â–µ–Ω–Ω—è –∑ `replaceAllText` –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∑–∞–π–≤–∏—Ö –∫–æ–ø—ñ–π
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ –æ—Å–Ω–æ–≤–Ω–∏–π –ø—Ä–æ—Ü–µ—Å

### –Ø–∫—â–æ batch –æ–ø–µ—Ä–∞—Ü—ñ—ó –Ω–µ –ø—Ä–∞—Ü—é—é—Ç—å:
1. –ó–º–µ–Ω—à–∏ `BATCH_SIZE` –¥–æ 2 –∞–±–æ 1
2. –î–æ–¥–∞–π –±—ñ–ª—å—à–µ –ø–∞—É–∑ –º—ñ–∂ –ø–∞—Ä—Ç—ñ—è–º–∏ (`await asyncio.sleep(2)`)
3. –ü–µ—Ä–µ–≤—ñ—Ä —Ä–æ–∑–º—ñ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞ - –≤–µ–ª–∏–∫—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å –º–µ–Ω—à–∏—Ö –ø–∞—Ä—Ç—ñ–π

### –Ø–∫—â–æ API –ø–æ–≤–µ—Ä—Ç–∞—î –ø–æ–º–∏–ª–∫–∏:
1. –°–ø—Ä–æ–±—É–π –ø—Ä–æ—Å—Ç–∏–π —Ç–µ—Å—Ç –∑ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏—á–Ω–æ–≥–æ —à–∞–±–ª–æ–Ω—É
2. –ü–µ—Ä–µ–≤—ñ—Ä URL —Å–µ—Ä–≤–µ—Ä–∞ —Ç–∞ –π–æ–≥–æ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å
3. –ü–µ—Ä–µ–≤—ñ—Ä —Ñ–æ—Ä–º–∞—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ API

---

## üìä –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –∑ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ

- **–ú–∞–ª—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏ (<20KB):** BATCH_SIZE = 5
- **–°–µ—Ä–µ–¥–Ω—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏ (20-50KB):** BATCH_SIZE = 3  
- **–í–µ–ª–∏–∫—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏ (>50KB):** BATCH_SIZE = 2, –∑–±—ñ–ª—å—à –ø–∞—É–∑–∏

---

## üéØ –ü—Ä–∏–∫–ª–∞–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –ü—Ä–∏–∫–ª–∞–¥ 1: –ü–æ–≤–Ω–∏–π Roll-Up
```python
TASK_TYPE = "FULL_ROLLUP"
CONTENT_TO_APPEND = """–ü—ñ–¥—Å—É–º–æ–∫ 2-–≥–æ —Ä—ñ–≤–Ω—è..."""
L1_HEADINGS_TO_TAG = ["–§–∞–π–ª: abc.txt", "–§–∞–π–ª: def.txt"]
TAG_TO_APPLY = "[–£–∑–∞–≥–∞–ª—å–Ω–µ–Ω–æ –≤ –ø—ñ–¥—Å—É–º–∫—É: L2-2025-01-01]"
```

### –ü—Ä–∏–∫–ª–∞–¥ 2: –¢—ñ–ª—å–∫–∏ —Ç–µ–≥—É–≤–∞–Ω–Ω—è
```python
TASK_TYPE = "BATCH_TAG_L1_RECORDS"
L1_HEADINGS_TO_TAG = ["–§–∞–π–ª: abc.txt", "–§–∞–π–ª: def.txt"]
TAG_TO_APPLY = "[–û–±—Ä–æ–±–µ—Ü—å: Bot-2025]"
```

---

## üìù Changelog

- **v4 (2025-01-XX):** –î–æ–¥–∞–Ω–æ –ø–∞—Ä—Ç—ñ–π–Ω—É –æ–±—Ä–æ–±–∫—É, –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫—É, —Å—Ç—Ä–∞—Ç–µ–≥—ñ—é –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è
- **v3:** –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –±–µ–∑–ø–µ—á–Ω–æ–≥–æ insertText (–∑–∞—Å—Ç–∞—Ä—ñ–ª–∏–π)
- **v2:** –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ –≤–µ—Ä—Å—ñ—ó (–∑–∞—Å—Ç–∞—Ä—ñ–ª—ñ)
 